name: Generate Daily Status Reports

on:
  schedule:
    # Run every day at 11:00 PM IST (17:30 UTC)
    - cron: '30 17 * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  generate-dsr:
    runs-on: ubuntu-latest
    
    steps:
      - name: Generate DSRs via API
        run: |
          curl -X POST "${{ secrets.APP_URL }}/api/generate-dsr" \
            -H "Content-Type: application/json" \
            -H "X-DSR-Secret: ${{ secrets.DSR_GENERATION_SECRET }}" \
            -d '{
              "date": "'$(date -d yesterday +%Y-%m-%d)'",
              "forceRegenerate": false
            }'
      
      - name: Check API Response
        if: failure()
        run: echo "DSR generation failed. Check application logs."

  notify-on-failure:
    runs-on: ubuntu-latest
    needs: generate-dsr
    if: failure()
    
    steps:
      - name: Send failure notification
        run: |
          echo "DSR generation failed on $(date)"
          # Add Slack/Email notification here if needed
